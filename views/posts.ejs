<!DOCTYPE html>
<html lang="en">
	<%- include('./partial/header.ejs') -%>

	<body>
		<container>
			<h1 class="">Posts:</h1>
			<ul>
				<% if (posts.length) { %>
					<% posts.forEach(({ id, title, date, text, author }) => { %>
						<article>
							<div class="info">
								<h2>
									<a href="/posts/<%= id %>"><%= title %></a>
								</h2>
								<button class="btn-delete" data-id="<%= id %>">
									<i class="fa-solid fa-trash-can" data-id="<%= id %>"></i>
								</button>
							</div>
							
							<p><%= text %></p>
							<div class="info">
								<span><%= date.toLocaleDateString() %></span>
								<span><%= author %></span>
							</div>
							
						</article>
					<% }) %>
				<% } %>
			</ul>
		</container>

		<script>
			document.addEventListener('click', e => {
				const id = e.target?.dataset?.id || null
				if (id) {
					fetch(`/posts/${id}`, {
						method: 'DELETE'
					}).then(() => {
						window.location.reload()
					})
				}
			})
		</script>
	</body>
</html>
